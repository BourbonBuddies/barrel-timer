<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, orientation=landscape">
  <title>Barrel Timer</title>
  <link rel="manifest" href="manifest.json">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: sans-serif;
      background: url('barrel_background.png') no-repeat center center fixed;
      background-size: cover;
      overflow: hidden;
      color: #f2e6d8;
    }
    .timer {
      position: absolute;
      transform: translate(-50%, -50%);
      text-align: center;
      touch-action: none;
    }
    input {
      background: none;
      border: none;
      color: #f2e6d8;
      text-align: center;
      display: block;
      margin: 2px auto;
      font-size: 16px;
    }
    .labels, .values {
      display: flex;
      justify-content: center;
      gap: 8px;
    }
    .labels div {
      font-size: 12px;
    }
    .values div {
      font-family: monospace;
      font-size: 20px;
    }
    button {
      background: none;
      border: none;
      color: #f2e6d8;
      font-size: 20px;
      margin: 2px auto;
      cursor: pointer;
      display: block;
    }
    @media screen and (orientation:portrait) {
      body::before {
        content: "Please rotate your device to landscape mode.";
        display: flex;
        align-items: center;
        justify-content: center;
        position: fixed;
        width: 100%;
        height: 100%;
        font-size: 24px;
        text-align: center;
        background: rgba(0,0,0,0.8);
        color: white;
        z-index: 1000;
      }
    }
  </style>
</head>
<body>
<div id="app"></div>
<script>
const coords = [
  {id:'A',x:400,y:250},{id:'B',x:700,y:250},{id:'C',x:1000,y:250},
  {id:'D',x:400,y:600},{id:'E',x:700,y:600},{id:'F',x:1000,y:600}
];

coords.forEach(cfg => {
  const t = document.createElement('div');
  t.className = 'timer'; t.id = 't' + cfg.id;
  const sp = JSON.parse(localStorage.getItem('pos' + cfg.id) || 'null');
  const left = (sp ? sp.x : cfg.x) / window.innerWidth * 100;
  const top = (sp ? sp.y : cfg.y) / window.innerHeight * 100;
  t.style.left = left + '%';
  t.style.top = top + '%';

  const title = document.createElement('input');
  title.type = 'text';
  title.maxLength = 14;
  title.value = localStorage.getItem('title' + cfg.id) || 'Barrel ' + cfg.id;
  title.onchange = () => localStorage.setItem('title' + cfg.id, title.value);

  const datetime = document.createElement('input');
  datetime.type = 'datetime-local';
  const start = localStorage.getItem('start' + cfg.id) || new Date().toISOString();
  datetime.value = start.slice(0, 16);
  datetime.onchange = () => localStorage.setItem('start' + cfg.id, new Date(datetime.value).toISOString());

  const labels = document.createElement('div');
  labels.className = 'labels';
  ['Days','Hours','Min','Sec'].forEach(label => {
    const d = document.createElement('div');
    d.innerText = label;
    labels.appendChild(d);
  });

  const values = document.createElement('div');
  values.className = 'values';
  values.id = 'v' + cfg.id;
  ['000','00','00','00'].forEach(val => {
    const d = document.createElement('div');
    d.innerText = val;
    values.appendChild(d);
  });

  const lock = document.createElement('button');
  let locked = localStorage.getItem('lock' + cfg.id) === '1';
  lock.innerText = locked ? 'ðŸ”’' : 'ðŸ”“';
  lock.onclick = () => {
    locked = !locked;
    localStorage.setItem('lock' + cfg.id, locked ? '1' : '0');
    lock.innerText = locked ? 'ðŸ”’' : 'ðŸ”“';
  };

  [title, datetime, labels, values, lock].forEach(el => t.appendChild(el));
  document.getElementById('app').appendChild(t);

  let dx = 0, dy = 0;

  t.addEventListener('pointerdown', e => {
    if (localStorage.getItem('lock' + cfg.id) === '1') return;
    const rect = t.getBoundingClientRect();
    dx = e.clientX - rect.left;
    dy = e.clientY - rect.top;
    t.setPointerCapture(e.pointerId);
  });

  t.addEventListener('pointermove', e => {
    if (!t.hasPointerCapture(e.pointerId)) return;
    if (localStorage.getItem('lock' + cfg.id) === '1') return;
    const x = e.clientX - dx;
    const y = e.clientY - dy;
    t.style.left = (x / window.innerWidth * 100) + '%';
    t.style.top = (y / window.innerHeight * 100) + '%';
  });

  t.addEventListener('pointerup', e => {
    if (localStorage.getItem('lock' + cfg.id) === '1') return;
    t.releasePointerCapture(e.pointerId);
    const rect2 = t.getBoundingClientRect();
    localStorage.setItem('pos' + cfg.id, JSON.stringify({x: rect2.left, y: rect2.top}));
  });

  (function update(){
    const now = new Date();
    const s = localStorage.getItem('start' + cfg.id) || now.toISOString();
    const diff = Math.floor((now - new Date(s)) / 1000);
    const d = String(Math.floor(diff / 86400)).padStart(3, '0'),
          h = String(Math.floor(diff % 86400 / 3600)).padStart(2, '0'),
          m = String(Math.floor(diff % 3600 / 60)).padStart(2, '0'),
          s2 = String(diff % 60).padStart(2, '0');
    const valArr = [d, h, m, s2];
    document.getElementById('v' + cfg.id).childNodes.forEach((node, i) => node.innerText = valArr[i]);
    requestAnimationFrame(update);
  })();
});

window.addEventListener('resize', () => location.reload());
</script>
</body>
</html>
